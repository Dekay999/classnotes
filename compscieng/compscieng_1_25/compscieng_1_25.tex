\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Ders 25

[ders notlarý atlandý]

IIR Filtreleri

Önceki dersteki FIR filtreleri sinyal üzerinde bir evriþimle tanýmlandý,
eldeki belli katsayýlarý geriye dönük ham sinyal üzerinde uygulayarak
filtrelenmiþ sinyali üretiyoruz,

$$ y[n] = a_0 x[n] + a_1 x[n-1] + a_2 x[n-2] +  a_3 x[n-3] + ... $$

Aslýnda filtreleme için ham sinyalin kendisi elimizdeki tek seçenek deðil,
sadece sinyal $x$ ile beraber geriye dönük þekilde $y$'nin kendisini de
kullanabilirdik, bu durumda $y$'yi üretmek için $y$'nin kendisini kullanmýþ
olurduk, bu sebeple bu tür filtrelere özyineli (recursive) filtreler ismi
de veriliyor. Yani

\begin{eqnarray}
y[n] = a_0 x[n] &+& a_1 x[n-1] + a_2 x[n-2] +  a_3 x[n-3] + ...  \\
 &+& b_1 y[n-1] + b_2 y[n-2] + b_3 y[n-3] + ..
\end{eqnarray}

Peki FIR yontemi ile filtre tasarlamayi biliyoruz, niye ustteki gibi bir
yaklasim kullanalim ki? Cevap ozyineli filtrelerin FIR'e gore cok hizli
islemeleri. IIR yonteminin de bazi negatif taraflari var, fakat bu
taraflardan uzak durabilirsek, optimal hizda isleyen filtreler elde etmek
mumkundur. 













z Transform 

z Transform, Laplace Transformunun ayrýksal dünyadaki karþýlýðýdýr,
transform edilen sürekli fonksiyon $f(t)$ deðil, ayrýksal, bir vektör
olarak görülebilecek $x(n)$'dir. z Transform

$$ Z[x(n)] \leadsto X(z) = \sum_{-\infty}^{\infty} x(n)z^{-n}  $$

ki $z$ bir kompleks sayýdýr. 

Geliþigüzel (casual) sistemlerden gelen verilerde sadece $n>0$ veriye
bakýlabilir, o zaman alt sýnýr sýfýr olur

$$ X(z) = \sum_{0}^{\infty} x(n)z^{-n}  $$

z Transform ne iþe yarar? Laplace Transform diferansiyel denklemlerin
çözülmesine yardým ediyordu. z Transform benzer þekilde farklýlýk
(difference) denklemlerin çözülmesine yardým eder. Farklýlýk denklemi
mesela

$$ y(n) = 0.85 y(n-1) + x(n) 
\mlabel{3}
$$

þeklinde olabilir. Daha genel olarak farklýlýk denklemleri þu þekilde
belirtilebilir,

$$ \sum_{k=0}^N a_k y(n-k) = \sum_{l=0}^M b_l x(n-l) 
\mlabel{1}
$$

Ýki üstteki örnek, bu genel denklemin $N=1,M=0$ olduðu halidir, katsayýlar
$a_1 = 0.85,b_0=1$. Genel formdan $y(n)$'i dýþarý çekebiliriz, o zaman
$k$ sýfýr yerine $k=1$'den baþlar

$$ y(n) + \sum_{k=1}^N a_k y(n-k) = \sum_{l=0}^M b_l x(n-l) $$

Genel çözüm için farklýlýk denkleminin bu formuna z Transform
uygulayabiliriz. 

Ama ondan önce kaydýrma iþlemi, lineerlik gibi bazý temel özellikleri,
iþlemleri görelim. Mesela

$$ X(z) = x(0) + x(1)z^{-1} + x(2) z^{-2} + ... 
\mlabel{2}
$$

ise, bu dizin üzerinde zaman kaydýrma iþlemi yapsak, yani $-1$ indeksi
$0$ haline gelse, onun gibi tüm deðerler bir ileri kaysa, $x(-1)$,
$x(0)$ olur, ve transform

$$ x(-1) + x(0)z^{-1} + x(1) z^{-2} + ...$$

Þimdi $z^{-1}$'i dýþarý çekelim

$$ = x(-1) + z^{-1} \bigg[ x(0) + x(1) z^{-1} + ... \bigg] $$

Köþeli parantez içine bakarsak, oradaki deðerler (2)'deki seriye benzemiyor
mu? O zaman oraya direk $X(z)$ deðerini koyabiliriz

$$ = x(-1) + z^{-1}X(z)$$

Bir daha kaydýrýrsak, 

$$ z^{-2}X(z) + z^{-1}x(-1) + x(-2) $$

elde ederiz. Genel olarak $m$ kadar kaydýrýrsak

$$ z^{-m}X(z^{-1}) + z^{-m+1}x(-1) + z^{-m+2}x(-2) + ... + x(-m) $$

Eðer baþlangýç þartlarý sýfýr ise, üstteki formülde $x(-1),x(-2),..$
tamamen sýfýr kabul edilebilir, ve daha basit þu formülü elde ederiz. 

$$ Z[x(n-m)] \leadsto z^{-m}X(z^{-1})$$

Ayrýca, z Transformun lineerlik özelliði sayesinde 

$$ Z(ax(n)) = aZ(x(n)) \leadsto aX(z) $$

Þimdi bu bilgiyle beraber (1)'in z Transformunu yapalým. 

$$ Y(z) + \sum_{k=1}^Na_kz^{-k}Y(z) = \sum_{l=0}^M b_l z^{-l}X(z)  $$

$$ \to Y(z) \bigg[ 1 + \sum_{k=1}^Na_kz^{-k} \bigg] = \sum_{l=0}^M b_l z^{-l}X(z)  $$

$$ \to Y(z)  = \frac{\sum_{l=0}^M b_l z^{-l}X(z) }{ 1 +
  \sum_{k=1}^Na_kz^{-k}} 
\mlabel{5}
$$

Formülün bölümdeki üst kýsmýný açarsak 

$$ b_0z^0 + b_1z^{-1} + b_2z^{-2} + ... + b_mz^{-M} $$

$b_0z^{-M}$ dýþarý çekilirse

$$ = b_0z^{-M}(z^M + \frac{b_1}{b_0}z^{M-1} +  \frac{b_2}{b_0}z^{M-2} +
.. + 
 \frac{b_M}{b_0})
$$

Bölümün alt kýsmýný açarsak 

$$ 1 + a_1z^{-1} + a_2z^{-2} + ... + a_Nz^{-N} $$

$z^{-N}$ dýþarý çekersek 

$$ = z^{-N} ( z^{N} + z^{N-1} + .. + a_N) $$

Bu yeni formlarý bölümde $Y(z)$ içinde yerine koyalým

$$ Y(z) = 
\frac{b_0z^{-M}(z^M + ..\frac{b_M}{b_0})}{z^{-N} ( z^{N} + .. + a_N)} 
$$

$$ = b_0 z^{N - M} \frac{z^M + ..\frac{b_M}{b_0}}{z^{N} + .. + a_N }$$

Bölüm ve bölene bir daha bakalým þimdi. Burada gösterilenler birer polinom,
ve Cebirin Temel Teorisi'ne (Fundamental Theorem of Algebra) göre $n$
derecesindeki bir $p(x)$ polinomunun mutlaka $n$ tane reel ya da kompleks
kökü vardýr. 

Bir polinomun kökü var ise, bu polinom $p(x)$ þu þekilde de gösterilebilir

$$ p(x) = (x-r_n)(x-r_{n-1})..(x-r_1) $$

Bu mantýðý iki üstteki formüle uygularsak 

$$ = b_0 z^{N - M} 
\frac{\prod_{l=1}^{M}(z-z_l)}{ \prod_{k=1}^{N}(z-p_k) }
$$

Yani $b_0z^{N-M}$ haricindeki ifadeler bir polinomun oluþmasýna sebep olurlar,
ve bu polinomun kökleri bulunabilir, kökler bulununca çözüm olan $z$ deðerleri
bulunmuþ olacaktýr. Bu $z$ deðerlerini alýp z Transformunu oluþturuz, ve ya
tabloya bakarak, ya da baþka þekilde ters transform yaparak farksal denklemin
çözümüne ulaþmaya çalýþýrýz.

Çözmek istediðimiz örnek (3)'e tekrar bakalým. Üstteki formüle bu noktada
gerek yok, (5)'e göre bile bu denklemin z Transformunu bulabiliriz. 

$$ Y(z) = \frac{1}{1-0.85z^{-1}} $$

Eðer yaygýn z Transformlarýn tablosuna bakarsak, $|z|>0.85$ için üstteki
formülün ters z Transformunun 

$$ h(n) = Z^{-1} [Y(z)] = 0.85^nu(n) $$

olduðunu öðreniyoruz, ve $u(n)$ þöyle 

$$
u(n) = 
\left\{ \begin{array}{ll}
1, & \textrm{ eðer } n \ge 0 \\ 
0, & \textrm{ eðer } n < 0
\end{array} \right.
$$

Dikkat edilirse ters z Transform tablosunda $y$ deðil $h$ bazlý sonuçlar
gösteriliyor, $h$ fonksiyonlarý dürtü cevabý (impulse response)
fonksiyonlarýdýr, ve hesaplamalarý evriþim (convolution) üzerinden
olur. Bir $h$, bir lineer sistemi özgün olarak temsil ettiði için $h$'i
alýp $y$ bazlý sonuca gitmek çok kolaydýr, hemen $h$'in tarif ettiði
evriþimi yaparýz.

$$ y(n) = \sum_{k=-\infty}^\infty x(k) h(n-k) = \sum_{k=-\infty}^\infty x(k) 0.85^{n-k} u(n-k). $$ 

Kodlama

Düþünelim ki (3) ile tarif edilen farklýlýk denklemi bir þirketin patent
portföyünü temsil ediyor. 

Bu þirket, her sene portföyü $y(n)$'e, $x(n)$ kadar yeni patent ekliyor,
ama her sene ayný zamanda elindeki patentlerin yüzde 15'i "eskiyor", yani
zamanlarý dolarak portföyünden çýkýyor. Bu eksiltme iþlemini bir önceki
$y(n)$'i 0.85 ile çarparak temsil ediyoruz. 

Böyle bir problemde $x(n)$ bize veri olarak verilecektir, ve toplamsal /
kümülatif (cumulative) $y(n)$'i hesaplamamýz istenecektir. Bu hesap
literatürde ``deðer kaybeden kümülatif toplam (cumulative sum with
deprecitation)'' olarak biliniyor.

O zaman üstteki formüldeki sonucu kodlarsak, ve örnek veriyle

\begin{minted}[fontsize=\footnotesize]{python}
patents = np.array([  4.,   3.,   2.,   8.,   4.,  
                      4.,  10.,   4.,  10.,   7.])

def u(n,k):
    if n-k < 0: return 0
    return 1.

def y(n,data):
    sum = 0
    for k in range(len(data)):
        sum += data[k]*(0.85**(n-k))*u(n,k)
    return sum

for n in range(len(patents)):    
    print  y(n,patents)
\end{minted}

\begin{verbatim}
4.0
6.4
7.44
14.324
16.1754
17.74909
25.0867265
25.323717525
31.5251598962
33.7963859118
\end{verbatim}

Bu sistemi otomatik olarak çözen Python iþlemi \verb!lfilter!
çaðrýsýdýr.

\begin{minted}[fontsize=\footnotesize]{python}
from scipy.signal import *

a = np.array([  4.,   3.,   2.,   8.,   4.,  
                4.,  10.,   4.,  10.,   7.])
d = 0.15 
res = lfilter((1,),(1,d-1),a) 
k = [a[0]] 
for inv in a[1:]: k.append((1-d)*k[-1] + inv) 
print np.array(k) 
\end{minted}

\begin{verbatim}
[  4.           6.4          7.44        14.324       16.1754      17.74909
  25.0867265   25.32371752  31.5251599   33.79638591]
\end{verbatim}

Not: Üstteki hesaplar [1] için kullanýldý.

Kaynaklar

[1] Bayramlý, M., {\em Patent Strategies and R\&D in Complex Product Industries},
    \url{http://amsdottorato.unibo.it/5151/1/bayramli_meltem_tesi.pdf}












\end{document}
