\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Frekans Analizi, Periyodik Sinyaller

Bir periyodik sinyali nasýl analiz ederiz? Kendimiz bir sinyal oluþturmak
istesek, bunu nasýl yapacaðýmýzý düþünelim; $\sin$ ya da $\cos$
fonksiyonlarýnýn bir periyotu vardýr, $0,2\pi$ arasýndaki deðerler
$2\pi,4\pi$ arasýnda tekrar eder, vs.. Bazý ek özellikler, mesela $\cos$
sýfýr noktasýnda 1 deðerine sahip, fakat elimizdeki zaman serisi saða ya da
sola ``kaymýþ'' olabilir, buna faz kaymasý (phase shift) deniyor, yani
sýfýr noktasýnda deðer 1 olmayabilir. Ayrýca -1,+1 arasýnda gidip gelmek
yerine mesela -10,+10 arasýnda gidip gelinebilir, buna genlik deniyor
(amplitude). Bir diðer özellik $0,2\pi$ arasýnda tek bir periyot yerine
birden fazla periyot olabilmesi (frekans).

Frekans ile baþlayalým, once normal bir kosinüs sinyali,

\begin{minted}[fontsize=\footnotesize]{python}
t = np.linspace(0,10,100)
plt.plot(t, np.cos(t))
plt.xlim(0,10)
plt.savefig('tser_freq_01.png')
\end{minted}

\includegraphics[height=5cm]{tser_freq_01.png}

Her $\pi$ noktasýný gösterelim,

\begin{minted}[fontsize=\footnotesize]{python}
plt.plot(t, np.cos(t))
plt.axvline(0,lw='1',ls='dashed',color='r')
plt.axvline(np.pi,lw='1',ls='dashed',color='r')
plt.axvline(2*np.pi,lw='1',ls='dashed',color='r')
plt.axvline(3*np.pi,lw='1',ls='dashed',color='r')
plt.xlim(0,10)
plt.savefig('tser_freq_02.png')
\end{minted}

\includegraphics[height=5cm]{tser_freq_02.png}

Bu sinyalde $\cos$'a verilen $t$ deðerlerini iki ile çarpsam ne olur? Bu
durumda mesela $0,2\pi$ arasýnda bir periyot için daha önceki $t$'lerin
yarýsý ile bu iþ yapýlabilir, demek ki önceki tek periyot içinde þimdi
sinyal iki kez tur atacaktýr. O zaman $\cos$ içinde bir sabit ile çarpým
yapmak ile frekansý o kadar arttýrmýþ oldum,

\begin{minted}[fontsize=\footnotesize]{python}
plt.plot(t, np.cos(2*t))
plt.axvline(0,lw='1',ls='dashed',color='r')
plt.axvline(np.pi,lw='1',ls='dashed',color='r')
plt.axvline(2*np.pi,lw='1',ls='dashed',color='r')
plt.axvline(3*np.pi,lw='1',ls='dashed',color='r')
plt.xlim(0,10)
plt.savefig('tser_freq_03.png')
\end{minted}

\includegraphics[height=5cm]{tser_freq_03.png}

-1/+1 arasýnda gidip gelmeyi arttýrmak en kolayý, $\cos$ hesabýndan elde
edilen deðeri mesela 10 ile çarparsam genlik o kadar artar. Faz kaydýrma
$\cos$ içinde bir toplam olabilir. Tüm resmi göstermek gerekirse, $A$
genlik, $f_0$ frekans, faz kaymasý $\phi$ olacak þekilde,

$$ 
x(t) = A \cos (2\pi f_0 t - \phi)
$$

Bu formülün grafiði,

\includegraphics[height=4cm]{tser_freq_04.png}

Direk formüle bakarak $A$ hemen anlaþýlabiliyor. Frekans $t$'yi çarpan
deðerle orantýlý, yanlýz dikkat, bu deðer her zaman $2\pi$'ye oranlý bir
þey, yani formül $\cos(10 t)$ gibi bir ifade içeriyorsa, $10 / 2\pi$ ile
$f_0$'yi çýkartmamýz gerekir. Eðer $t$ saniye birimine sahipse, bir periyot
$T_0 = 1/f_0 = 0.5$ saniyedir, ve frekans 2 Hertz olacaktýr. Eger frekans
$w_0 = 2\pi f_o$ formunda gösterilirse, o zaman birim radyan / saniye olur.

Faz kaymasý $\phi$ sebebiyle tepe noktanýn nerede olduðu da direk formülden
anlaþýlamiyor, biraz ek hesap lazým, üstteki örnekte 3/16, bunu bulmak
için ``kosinüse geçilen deðerin sýfýr olduðu yer'' gerekli,

$$ 0 = 2\pi \cdot 2 \cdot t  - 3\pi/4 
\implies t = 3\pi / (4 \cdot 4\pi)  
\implies t = 3/16
$$

Fakat hala faz kaymasý $3\pi/4$ diyebiliriz. 

Örneklemek (Sampling)

Sayýsal, yani bilgisayar ortamýnda bilgiler ayrýksaldýr, kimse bize üstteki
sürekli formül formatýyla sinyal parametrelerini vermez. Diyelim ki bir
sinyalin saniyede 10 tane örneklemini alýyoruz. O zaman 3 saniye sonra
elimizde 30 veri noktasý olacak. Fakat her örneklem frekansý gerçek sinyali
incelemek için yeterli deðildir. Nyquist teorisine göre örneklem gerçek
frekansýn en az iki katý olmalýdýr 


Tabii sadece ayriksal frekansa bakarak sinyalin frekansýnýn ne olduðunu
anlamak ta mumkun degil. Eðer bir þekilde gercek sinyalin kaç örneklemde
bir tekrar ettiðini bulursak, o zaman yaklaþýk bir frekans bulabiliriz;
mesela bir sinüssel sinyalin 20 ölçümde bir tekrar ettiðini bulduk, ve
örneklem periyotu 0.05 milisaniye / örneklem ise (her iki örneklem arasý
geçen zaman), o zaman

$$ 
\textrm{sinüs dalgasý periyotu} =  
\frac{20 \textrm{ örneklem}}{periyot}
\frac{0.05 \textrm{ milisaniye}}{\textrm{örneklem}} = 1 milisaniye
$$

Demek ki periyot 1 / 1 milisaniye = 1 Khz. Ya örneklem periyotu 2
milisaniye olsaydý? O zaman sinüs dalga periyotu 40 milisaniye olurdu, ve
gerçek frekans 25 Hz olurdu. Söylemek istediðimiz ayrýksal durumda
Hz. bazýnda gerçek frekansýn hesabý her zaman örneklem frekansýna $f_s$'e
baðlýdýr,

$$ f_s = 1 / t_s$$


\inputminted[fontsize=\footnotesize]{python}{filt.py}

\begin{minted}[fontsize=\footnotesize]{python}
import filt
fy=300; #signal frequency in Hz
wy=2*np.pi*fy; #signal frequency in rad/s
fs=50; #sampling frequency in Hz
tiv=1./fs; #time interval between samples;
tend = 5 # seconds
t=np.linspace(0,tend,tend/tiv); #time intervals set (5 seconds)

y=0.6*np.sin(wy*t)+0.3*np.sin(3*wy*t)+0.2*np.sin(5*wy*t); #signal data set
f=plt.figure()
plt.plot(t,y)
plt.savefig('tser_freq_05.png')

fou = np.fft.fft(y, fs)
hmag=np.real(fou); ah=hmag/len(t);
f=plt.figure()
plt.stem(range(10),ah[:10])
plt.savefig('tser_freq_06.png')

order = 32
fc1 = 2
fs = 20
f1 = filt.sinc_filter_low(order, fc1, fs).T[0];

y1 = np.convolve(f1, y)
f=plt.figure()
plt.plot(np.arange(len(y1)), y1)
plt.savefig('tser_freq_08.png')

fou = np.fft.fft(y1, fs)
hmag=np.real(fou); ah=hmag/len(t);
f=plt.figure()
plt.stem(range(10),ah[:10])
plt.savefig('tser_freq_07.png')
\end{minted}

\includegraphics[width=20em]{tser_freq_05.png}

\includegraphics[width=20em]{tser_freq_06.png}

\includegraphics[width=20em]{tser_freq_07.png}

\includegraphics[width=20em]{tser_freq_08.png}


\begin{minted}[fontsize=\footnotesize]{python}
fc1 = 3
f2 = filt.sinc_filter_high(order, fc1, fs).T[0];

y2 = np.convolve(f2, y)
f=plt.figure()
plt.plot(np.arange(len(y2)), y2)
plt.savefig('tser_freq_10.png')

fou = np.fft.fft(y2, fs)
hmag=np.real(fou); ah=hmag/len(t);
f=plt.figure()
plt.stem(range(10),ah[:10])
plt.savefig('tser_freq_09.png')
\end{minted}

\includegraphics[width=20em]{tser_freq_09.png}

\includegraphics[width=20em]{tser_freq_10.png}


\begin{minted}[fontsize=\footnotesize]{python}
fc1 = 2
fc2 = 4
f3 = filt.sinc_filter_band(order, fc1, fc2, fs);

y3 = np.convolve(f3, y)
f=plt.figure()
plt.plot(np.arange(len(y3)), y3)
plt.savefig('tser_freq_12.png')

fou = np.fft.fft(y3, fs)
hmag=np.real(fou); ah=hmag/len(t);
f=plt.figure()
plt.stem(range(10),ah[:10])
plt.savefig('tser_freq_11.png')
\end{minted}

\includegraphics[width=20em]{tser_freq_11.png}

\includegraphics[width=20em]{tser_freq_12.png}


\begin{minted}[fontsize=\footnotesize]{python}
from scipy.signal import butter, lfilter
def butter_bandpass(lowcut, highcut, fs, order=5):
    nyq = 0.5 * fs
    low = lowcut / nyq
    high = highcut / nyq
    print  low, high
    b, a = butter(order, [low, high], btype='band')
    return b, a

def butter_bandpass_filter(data, lowcut, highcut, fs, order=5):
    b, a = butter_bandpass(lowcut, highcut, fs, order=order)
    y = lfilter(b, a, data)
    return y

yb = butter_bandpass_filter(y, 2, 4, fs, order=5)
plt.plot(np.arange(len(yb)), yb)
plt.savefig('tser_freq_13.png')
\end{minted}

\begin{verbatim}
0.2 0.4
\end{verbatim}

\includegraphics[width=20em]{tser_freq_13.png}




















[devam edecek]

Kaynaklar

\end{document}






















