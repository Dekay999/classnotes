\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Adým Ölçmek, Pedometre

Cep telefonlarýnýn çoðunda artýk ivmeölçer (acceloremeter) algýlayýcýlar
var; bu algýlayýcýlar telefonun $x,y,z$ eksenlerini baz alarak tüm
eksenlerde ne kadar ivme etkisi olduðunu ölçüyorlar. Bu etkilerden en
büyüklerinden biri tabii ki yerçekimi, telefonda hiçbir hareket olmasa bile
telefonu tutuþa göre 9.8 metre / $s^2$'lik bir ivme tek ya da tüm eksenlere
daðýlmýþ olarak ölçülecektir [4]. Yürürken, adým atarken meydana çýkan
yukarý ve aþaðý yönde kuvvet uygulamasý da ivmeölçerlerle yakalanýr. Bu
ölçümleri kullanarak acaba atýlan adým sayýsýný bulamaz mýyýz? [5]'deki
uygulamayý kullanarak alýnan ölçümlere bakalým,

\begin{minted}[fontsize=\footnotesize]{python}
import pandas as pd
dfacc = pd.read_csv('acc.txt',header=None,sep='\s+')
print dfacc.head()
\end{minted}

\begin{verbatim}
               0         1         2         3
0  1493818386218 -0.147100  6.972528  6.707748
1  1493818386422 -0.215746  7.001948  6.854848
2  1493818386610 -0.304006  7.041174  6.697942
3  1493818386812 -0.304006  7.050981  6.884268
4  1493818387008 -0.225553  7.011754  6.943108
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
steps1 = np.sqrt(np.sum(dfacc[[1,2,3]]**2, axis=1))
steps2 = steps1 - 9.8
steps2[:200].plot()
plt.savefig('compscieng_app40walk_01.png')
\end{minted}

\includegraphics[height=6cm]{compscieng_app40walk_01.png}

Üç eksendeki ivme ölçümünün normalize ettik (karelerinin toplamýnýn
karekökü), 

$$ r = \sqrt{r_x^2 + r_y^2 + r_z^2}$$

Daha önce belirtildiðimiz gibi telefonun duruþu deðiþik þekillerde
olabilir, ve yerçekiminde olduðu gibi bu ölçümler üç eksene daðýlmýþ
olacaktýr. Bu üç ölçümü birleþtirerek esas bizi ilgilendiren hesaba daha
yaklaþmýþ olmayý umduk. 

Sonuçlar fena deðil, baþtaki sýfýra yakýn bölgede hiç hareket etmiyorduk
mesela, ve ivme hesabý burada ufak bir deðer gösteriyor. Yapýlan bir ek
iþlemden daha bahsedelim, 9.8'lik yerçekimi ivmesini karekökten çýkarttýk
çünkü yerçekimini ölçmekle de ilgilenmiyoruz (hep ayný zaten), bu deðeri
çýkartarak yine bizi ilgilendiren veriyi daha net þekilde görebileceðimizi
umduk. Altta bu çýkartma öncesi ve sonrasýnda yapýlan Fourier analizine
göre yerçekimi çýkartýlmýþ verinin ilgilendiðimiz frekanslarý daha net
gösterdiði belli oluyor.

\begin{minted}[fontsize=\footnotesize]{python}
import sys; sys.path.append('../compscieng_1_32')
import filt
f=plt.figure()
filt.plotSpectrum(steps1, 6)
plt.savefig('compscieng_app40walk_02.png')
f=plt.figure()
filt.plotSpectrum(steps2, 6)
plt.savefig('compscieng_app40walk_06.png')
\end{minted}

\includegraphics[height=6cm]{compscieng_app40walk_02.png}
\includegraphics[height=6cm]{compscieng_app40walk_06.png}

1 Hz. ve 2 Hz. seviyesindeki frekanslar ilginç, bunlar saniyede bir ve iki
adýma tekabül ediyor olmalýlar. 

Adým saymak için zaman serilerinde tepe / uç nokta bulabilen kodlar
kullanacaðýz, \verb!peakutils! altýnda bu kodlarý görüyoruz; bu kodlarla
belli eþik, minimum mesafe deðerlerini belirleyerek bir zaman serisindeki
uç noktalarý bulabiliyoruz.

\begin{minted}[fontsize=\footnotesize]{python}
import peakutils
idx = peakutils.indexes(steps2, thres=0.1, min_dist=3)
print len(idx), u'tepe noktasý var'
plt.plot(steps2)
plt.plot(idx,steps2[idx],'rd')
plt.savefig('compscieng_app40walk_03.png')
\end{minted}

\begin{verbatim}
89 tepe noktasý var
\end{verbatim}

Bu noktalarýn alt bölümü de var tabii, bu nihai sayý için üstteki sonucu
iki ile çarpabiliriz. Hesap fena deðil, bu deney için 170 adým atmýþtýk.

\includegraphics[height=6cm]{compscieng_app40walk_03.png}

Tepe bulmaktaki farklý parametre etkilerini de gösterelim. Önce gürültülü,
iki büyük tepeden oluþan bir yapay veri üretelim,

\begin{minted}[fontsize=\footnotesize]{python}
import peakutils
np.random.seed(0)
centers = (30.5, 72.3)
x = np.linspace(0, 120, 121)
y = peakutils.gaussian(x, 5, centers[0], 3) + \
    peakutils.gaussian(x, 7, centers[1], 10) + \
    np.random.rand(x.size)
\end{minted}

Þimdi farklý parametrelerle tepe noktalarýný bulalým,

\begin{minted}[fontsize=\footnotesize]{python}
plt.figure()
plt.plot(x, y)
indexes = peakutils.indexes(y, thres=0.5, min_dist=30)
plt.plot(x[indexes], y[indexes], 'rd')
plt.savefig('compscieng_app40walk_04.png')
plt.figure()
plt.plot(x, y)
indexes = peakutils.indexes(y, thres=0.5, min_dist=3)
plt.plot(x[indexes], y[indexes], 'rd')
plt.savefig('compscieng_app40walk_05.png')
plt.figure()
plt.plot(x, y)
indexes = peakutils.indexes(y, thres=0.1, min_dist=5)
plt.plot(x[indexes], y[indexes], 'rd')
plt.savefig('compscieng_app40walk_07.png')
\end{minted}

\includegraphics[height=4cm]{compscieng_app40walk_04.png}
\includegraphics[height=4cm]{compscieng_app40walk_05.png}
\includegraphics[height=4cm]{compscieng_app40walk_07.png}

Parametre \verb!thres! dikey bir eþik deðeri tanýmlýyor, en yüksek nokta
1.0 olacak þekilde. Mesela yarým seviyede minimal bir yükseklik eþik deðeri
0.5 ile tanýmlanabilir, o zaman sadece bu deðer üstündeki noktalar tepe
olarak saptanacaktýr. Yatay yönde ama bu sefer reel deðer bazlý bir eþik
deðeri \verb!min_dist! ile verilir, bu durumda tepe noktalarý arasýnda en
az bu kadar mesafe olmasý gerekir.

Kaynaklar

[4] Daskalov, {\em A Pedometer in the Real World}, \url{http://www.aosabook.org/en/500L/a-pedometer-in-the-real-world.htm}

[5] Bayramlý, {\em Algýlayýcý Ölçümleri, Video, Android}, \url{http://sayilarvekuramlar.blogspot.de/2017/02/algilayici-olcumleri-video-android.html}

\end{document}


















