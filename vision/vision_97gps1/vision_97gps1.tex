\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
GPS, Kullanýcý Yerini Uzaklýk ile Bulmak, GPS Uydularýna Olan Açý

Küresel Konumlama Sistemi (Global Positioning System -GPS-) ile dünyada
nerede olduðumuzu kolay bir þekilde bulabiliyoruz. GPS'in temelinde eldeki
bir alýcýnýn dünya etrafýnda sürekli dönen uydulara olan mesafesini ölçerek
bunlara göre bir konumlama yapmasý yatýyor. Eldeki alýcý, ki artýk ucuz bir
akýllý telefon bile olabiliyor, önce Almanak denen bir bilgiyi (eðer o anda
elde yoksa) uydudan alýyor. Bu bilgi tüm GPS uydularýnýn kesin yerlerini
alýcýya söyler. Ardýndan uydu ve alýcý arasýnda sinyallerin alýnýp
verilmesindeki zaman farkýna bakýlarak olabildiðince detaylý bir mesafe
bilgi alýnýr. Eðer en az 4 tane uyduya olan mesafe bu þekilde
alýnabiliyorsa bir üçgenleme yapýlarak alýcýnýn yeryüzündeki yeri
saptanabilir. Uydular her biri yeterince büyük bir bölgeye servis edebilsin
diye çok uzaktaki bir yörüngededirler, dünyaya ortalama mesafeleri 20,000
kilometre (evet, yirmi bin), kýyasla ISS uzay istasyonu yaklaþýk 200
km. mesafede.

\includegraphics[width=15em]{sat1.jpg}

Bu yazýda mesafeleri kullanýp nerede olduðumuz konusuna girmeden eðer
nerede olduðumuz biliniyor olsa uyduya olan yatay açý / azimut (azimuth) ve
yüksekliði (elevation) nasýl buluruz konusunu iþleyeceðiz.

Azimut nedir? Yeryüzünde duruyoruz, yüzümüzü kuzeye dönelim, bu referans
duruþu. Eðer mesela azimut 324 derece ise, doðuya doðru o kadar döneriz (ya
da batýya 360-324 kadar dönebiliriz, farketmez), ve baþýmýzý yukarý doðru
yükseklik açýsý kadar kaldýrýrýz, mesela 67 ise 67 derece yukarý doðru, ki
90 derece tam dik yukarý bakýyoruz demektir. Aþaðý yukarý alttaki resimdeki
gibi bir durum olur,

\includegraphics[width=20em]{azelzen.png}

Fakat ustteki turden bir gosterim aslinda kullanici merkezli bir hesaptir,
akat GPS uydulari, hatta kullanicinin yeri dunyayi merkez alan, daha net
sekilde belirtmek gerekirse dunyanin merkezini merkez alan (orasi orijin
sayiliyor, (0,0,0) noktasi) sistemindedir. 

\includegraphics[width=20em]{eci.jpg}

Bu sisteme ECI sistemi, ya da ECEF kordinatlari deniyor. Tabii mesela
kilometre baglaminda mesela (1,1,1) noktasi anlamsiz olabilir, dunyanin
``icinde'', yerkabugunun altinda bir nokta olacaktir, fakat dunya yuzeyi,
ve yuzeyden daha ustteki mesela uydular icin anlamli ve kullanisli bir
sistem. Daha onemlisi bu sistem bize Kartezyen geometrisi kullanmamiza izin
verecek, ve daha ileride gorecegimiz gibi uzaklik hesaplarinda faydali
olacak.

\includegraphics[width=15em]{gpstest.png}

\includegraphics[width=40em]{waas_sats.png}

\includegraphics[width=25em]{ecef_topo.png}

\inputminted[fontsize=\footnotesize]{python}{orbital.py}

\begin{minted}[fontsize=\footnotesize]{python}
import orbital
from datetime import datetime
millis = 1493036068479
dt = datetime.fromtimestamp(millis/1000.0)
dtj = orbital.jdays(datetime.fromtimestamp(millis/1000.0))
print dtj
\end{minted}

\begin{verbatim}
2457868.09339
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
lon = 13.442383333333332
lat = 52.483086666666665
alt = 0
sat_alt = 20*1000*1000

sats = [[11,-164.259351,30.518234],[18,-57.092297,1.027207],
        [16,-122.123140,-55.533692],[24,17.625305,45.299193],
        [31,-102.581100,13.344068]]

for (prn,sat_lon,sat_lat) in sats:
    az,el,r = orbital.get_observer_look(sat_lon, sat_lat, sat_alt, dt, lon, lat, alt)
    print prn, az, el, r   
\end{minted}

\begin{verbatim}
11 358.005492414 -6.99245765159 20007166.964
18 254.95693367 12.52250143 20004991.9173
16 245.378821316 -64.1703023622 20012088.4789
24 157.451172143 82.3085240779 20000057.3405
31 298.723320912 -4.42938085218 20006877.4437
\end{verbatim}


Uzaklýktan Kullanýcý Pozisyonunu Bulmak

Ayni zamanda bir GPS alicisi olan akilli cep telefonlari o an goruntude
olan GPS uydularina olan mesafeyi hesaplayabilir. Bunu bir uydudan
gonderilen sinyallerin erisim mesafesini hesaplayarak yaparlar; 

\includegraphics[width=25em]{trilat1.png}

\includegraphics[width=25em]{trilat2.png}


$$ 
P^i = \sqrt{ \big( (x^i-x)^2 + (y^i-y)^2 + (z^i-z)^2  \big) } + c\tau
$$


$$ P_{\textrm{gözlem}} = p_{model} + \textrm{gürültü} $$

$$ 
= P(x,y,z,\tau) + v
$$

$$ 
P(x,y,z,\tau) = P(x_0,y_0,z_0,\tau_0) + 
(x-x_0)\frac{\partial P}{\partial x} + 
(y-y_0)\frac{\partial P}{\partial y} + 
(z-z_0)\frac{\partial P}{\partial z} + 
(\tau-\tau_0)\frac{\partial P}{\partial \tau}  + ...
$$

$$ 
= P_{hesap} + \frac{\partial P}{\partial x} \Delta x + 
\frac{\partial P}{\partial y} \Delta y + 
\frac{\partial P}{\partial z} \Delta z + 
\frac{\partial P}{\partial \tau} \Delta \tau 
$$

$$ \Delta P \equiv P_{\textrm{gözlem}} - P_{hesap} $$

$$ = \frac{\partial P}{\partial x} \Delta x + 
\frac{\partial P}{\partial y} \Delta y + 
\frac{\partial P}{\partial z} \Delta z + 
\frac{\partial P}{\partial \tau} \Delta \tau 
+ v
$$
Matris formunda yazarsak, 

$$ \Delta P = \left[\begin{array}{cccc}
\dfrac{\partial P}{\partial x} \Delta x & 
\dfrac{\partial P}{\partial y} \Delta y & 
\dfrac{\partial P}{\partial z} \Delta z & 
\dfrac{\partial P}{\partial \tau} \Delta \tau
\end{array}\right]
\left[\begin{array}{c}
\Delta x \\ \Delta y \\ \Delta z \\ \Delta \tau 
\end{array}\right] + v
$$


$$ 
\begin{bmatrix}
\Delta P^1 \\[1ex]
\Delta P^2 \\[1ex] 
\Delta P^3 \\[1ex] 
\vdots \\[1ex]
\Delta P^m 
\end{bmatrix}
= 
\begin{bmatrix}
\dfrac{\partial P^1}{\partial x} & 
\dfrac{\partial P^1}{\partial y} & 
\dfrac{\partial P^1}{\partial z} & 
\dfrac{\partial P^1}{\partial \tau}
\\[2ex]
\dfrac{\partial P^2}{\partial x} & 
\dfrac{\partial P^2}{\partial y} & 
\dfrac{\partial P^2}{\partial z} & 
\dfrac{\partial P^2}{\partial \tau}
\\[2ex]
\dfrac{\partial P^3}{\partial x} & 
\dfrac{\partial P^3}{\partial y} & 
\dfrac{\partial P^3}{\partial z} & 
\dfrac{\partial P^3}{\partial \tau} 
\\[2ex]
\vdots & \vdots & \vdots & \vdots \\[2ex]
\dfrac{\partial P^m}{\partial x} & 
\dfrac{\partial P^m}{\partial y} & 
\dfrac{\partial P^m}{\partial z} & 
\dfrac{\partial P^m}{\partial \tau} 
\end{bmatrix} 
\begin{bmatrix}
\Delta x \\[1ex]
\Delta y \\[1ex] 
\Delta z \\[1ex] 
\Delta \tau
\end{bmatrix} + 
\begin{bmatrix}
v_1 \\[1ex]
v_2 \\[1ex] 
v_2 \\[1ex] 
\vdots \\[1ex] 
v_m
\end{bmatrix}
$$

Bu sistemi bir $b = Ax + v$ lineer sistemi olarak gorebiliriz, ki en az
kareler yontemi sistemi cozer. $A$ matrisinin icerigi icin kismi turevlerin
alinmasi lazim, bu turevler, mesela $P^1$ ve $x$ icin 

$$ 
\frac{\partial P^1}{\partial x} = 
\frac{x^1-x}{\sqrt{ \big( (x^i-x)^2 + (y^i-y)^2 + (z^i-z)^2  \big) }} = \frac{x^1-x}{\rho}
$$

Tum olcumler ve degiskenler icin yapalim,

$$ 
A = \left[\begin{array}{cccc}
\dfrac{x - x^1}{\rho} & \dfrac{y - y^1}{\rho} & \dfrac{z - z^1}{\rho} & c \\
\dfrac{x - x^2}{\rho} & \dfrac{y - y^2}{\rho} & \dfrac{z - z^2}{\rho} & c \\
\dfrac{x - x^3}{\rho} & \dfrac{y - y^3}{\rho} & \dfrac{z - z^3}{\rho} & c \\
\vdots & \vdots & \vdots & \vdots \\
\dfrac{x - x^m}{\rho} & \dfrac{y - y^m}{\rho} & \dfrac{z - z^m}{\rho} & c 
\end{array}\right]
$$


\begin{minted}[fontsize=\footnotesize]{python}
import matplotlib.pyplot as plt
import scipy.linalg as lin

clight = 299792458
xtrue = [3507884.948, 780492.718, 5251780.403, 0]

xxyyzz = [[16577402.072, 5640460.750, 20151933.185],
	  [11793840.229, -10611621.371, 21372809.480],
	  [20141014.004, -17040472.264, 2512131.115],
	  [22622494.101, -4288365.463, 13137555.567],
	  [12867750.433, 15820032.908, 16952442.746],
	  [-3189257.131, -17447568.373, 20051400.790],
	  [-7437756.358, 13957664.984, 21692377.935]]

xxyyzz = np.array(xxyyzz)

pseudorange = np.array([20432524.0, 21434024.4, 24556171.0, 
                        21315100.2, 21255217.0, 24441547.2, 23768678.3])

xx = xxyyzz[:,0]
yy = xxyyzz[:,1]
zz = xxyyzz[:,2]
x = [0, 0, 0, 0]
A = np.ones((len(xxyyzz),4))
for iter in range(20):
    rng = np.sqrt((x[0]-xx)**2+(x[1]-yy)**2+(x[2]-zz)**2);
    F = rng + x[3]
    irange = 1/rng;
    A[:,0] = irange*(x[0]-xx)
    A[:,1] = irange*(x[1]-yy);
    A[:,2] = irange*(x[2]-zz);
    c = np.dot(A.T,pseudorange-F)
    N = np.dot(A.T,A)
    deltahat = lin.solve(N,c)
    x = x+deltahat
    if np.max(np.abs(deltahat))<0.001: break

print 'iter', iter
print np.reshape(x, (4,1))
\end{minted}

\begin{verbatim}
iter 4
[[ 3507889.12958827]
 [  780490.02116445]
 [ 5251783.75537277]
 [   25511.14592576]]
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
import orbital
print orbital.ecef2lla(x)
\end{minted}

\begin{verbatim}
(55.796250049381591, 12.543735075055356, 73.165498103015125)
\end{verbatim}

\includegraphics[width=25em]{denmark.jpg}

Kaynaklar 

[1] Federal Aviation Administration, {\em Uydu Pozisyonlarý}, \url{http://www.nstb.tc.faa.gov/incoming/Waas_Sv_Status.txt}

[2] Federal Aviation Administration, {\em WAAS Satellite Status}, \url{http://www.nstb.tc.faa.gov/RT_WaasSatelliteStatus.htm}

[3] Kelso, {\em Orbital Coordinate Systems, Part II}, \url{http://celestrak.com/columns/v02n02/}

[4] Raspaud, {\em PyOrbital}, \url{https://github.com/pytroll/pyorbital}

[5] Blewitt, {\em Basics of the GPS Technique: Observation Equations},  \url{http://www.nbmg.unr.edu/staff/pdfs/Blewitt%20Basics%20of%20gps.pdf}

[6], Nielsen, {\em Least Squares Adjustment: Linear and Nonlinear Weighted Regression Analysis}, \url{http://www2.imm.dtu.dk/pubdb/views/edoc_download.php/2804/pdf/imm2804.pdf}

[7], Chartcross Limited, {\em GPS Test}, \url{https://play.google.com/store/apps/details?id=com.chartcross.gpstest}

[8], Raquet, {\em Calculation of GPS PNT Solution}, \url{http://indico.ictp.it/event/a12180/session/21/contribution/12/material/0/0.pdf}

\end{document}


